<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Breakout Game</title>
</head>
<body>
    <canvas id="canvas" height="300" style="border:1px solid black;border-bottom: 2px solid brown;">Heyyy canvas is not supported</canvas>
    <button onclick="startGame()">Start</button>
    <script>
        const canvas = document.getElementById('canvas')
        const ctx = canvas.getContext('2d')
        const canvasH = canvas.height
        const canvasW = canvas.width

        let rightPressed = false
        let leftPressed = false
        document.addEventListener('keydown',handleKeyDown)
        document.addEventListener('keyup',handleKeyUp)

        function handleKeyDown(e) {
            if(e.key === "ArrowRight"){
                rightPressed = true
            }
            if(e.key === "ArrowLeft"){
                leftPressed = true
            }
        }

        function handleKeyUp(e) {
            if(e.key === "ArrowRight"){
                rightPressed = false
            }
            if(e.key === "ArrowLeft"){
                leftPressed = false
            }
        }

        let x, y, dy, dx, interval ,radius ,paddleW ,paddleX ,paddleY
        setVariables()
        drawBall()
        drawPaddle()
        // startGame()

        function detectCollision() {
            if(x + dx >= canvasW || x + dx < 0){
                dx = -dx
            }

            if( y + dy > canvasH - radius){
                if(x + dx > paddleX && x + dx < (paddleX + paddleW)){
                    dy = -dy
                }
            }

            if(y + dy < 0){
                dy = -dy
            }
        }

        function startGame() {
            if(!interval){
                interval = setInterval(() => {
                    if(rightPressed){
                        paddleX = paddleX + 5
                    }
                    if(leftPressed){
                        paddleX = paddleX - 5
                    }
                    detectCollision()
                    x = x + dx
                    y = y + dy
                    checkGameover()
                    ctx.clearRect(0,0,canvasW,canvasH)
                    drawPaddle()
                    drawBall()
                }, 20)
            }
        }

        function checkGameover() {
            if(y === canvasH){
                alert('game over')
                clearInterval(interval)
                interval = null
                setVariables()
            }
        }

        function setVariables() {
            x = canvasW/2
            y = canvasH - 20
            dx = 5
            dy = -5
            radius = 10
            paddleW = 50
            paddleX = canvasW/2 - paddleW/2
            paddleY = canvasH - 10
        }

        function drawBall() {
            ctx.beginPath()
            ctx.arc(x,y,radius,0,2* Math.PI,false)
            ctx.fillStyle = "#389393"
            ctx.fill()
            ctx.closePath()
        }

        function drawPaddle() {
            ctx.beginPath()
            ctx.rect(paddleX,paddleY,paddleW,10)
            ctx.fillStyle = "#3797a4"
            ctx.fill()
            ctx.closePath()
        }
    </script>
</body>
</html>